<script>
/* ---------- Matrix Rain ---------- */
const canvas = document.getElementById('matrix'), ctx = canvas.getContext('2d');
let W,H,cols,ypos;
function initMatrix(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;cols=Math.floor(W/18);ypos=Array(cols).fill(0).map(()=>Math.random()*H)}
function matrixLoop(){ctx.fillStyle='rgba(0,0,0,0.07)';ctx.fillRect(0,0,W,H);ctx.fillStyle='rgba(0,220,255,0.18)';ctx.font='14px monospace';
 for(let i=0;i<cols;i++){const txt=String.fromCharCode(0x30A0+Math.random()*96);ctx.fillText(txt,i*18,ypos[i]);ypos[i]+=14+Math.random()*20;if(ypos[i]>H) ypos[i]=0}}
initMatrix(); (function mloop(){matrixLoop(); requestAnimationFrame(mloop)})(); addEventListener('resize',initMatrix);

/* ---------- Parallax Wolf Movement ---------- */
const wolfImg = document.querySelector('.wolf-img');
document.addEventListener('mousemove', (e)=>{
  const cx = innerWidth/2, cy = innerHeight/2;
  const dx = (e.clientX - cx)/cx, dy = (e.clientY - cy)/cy;
  wolfImg.style.transform = `translate(${dx*6}%, ${-6 + dy*3}vh) scale(${1 + Math.abs(dx)*0.02})`;
  document.querySelector('.wolf-eyes').style.transform = `translate(${dx*10}px, ${dy*6}px)`;
});

/* ---------- Sparks ---------- */
function makeSparks(count=12){
  const container = document.getElementById('sparks');
  for(let i=0;i<count;i++){
    const s=document.createElement('div'); s.className='spark';
    s.style.left = (20+Math.random()*60)+'%';
    s.style.top  = (10+Math.random()*80)+'%';
    s.style.background = Math.random()>0.5 ? 'linear-gradient(90deg,#fff,#ff6b6b)' : 'linear-gradient(90deg,#aaffff,#00bfff)';
    container.appendChild(s);
    setTimeout(()=>{ s.style.opacity=1; s.style.transform='scale(1)'; s.style.transition='transform .45s linear, opacity .45s'; }, 10);
    setTimeout(()=>{ s.style.opacity=0; s.style.transform='scale(.2)'; s.style.transition='transform .7s, opacity .7s'; setTimeout(()=>s.remove(),900); }, 550 + Math.random()*900);
  }
}

/* ---------- Wave ---------- */
function wavePulse(){
  const w = document.getElementById('wave');
  w.style.left='50%'; w.style.top='50%'; w.style.opacity=1; w.style.transform='translate(-50%,-50%) scale(.4)';
  w.style.background = 'radial-gradient(circle, rgba(0,200,255,0.35), rgba(0,150,255,0.08))';
  w.style.boxShadow='0 0 30px rgba(0,200,255,0.2)';
  w.style.transition='transform .9s ease-out, opacity .9s';
  w.style.animation='none';
  setTimeout(()=>{ w.style.transform='translate(-50%,-50%) scale(2.3)'; w.style.opacity=0; }, 20);
  setTimeout(()=>{ w.style.opacity=0; }, 1000);
}

/* ---------- SCAN BUTTON LOGIC (UPDATED API URL) ---------- */
const scanBtn = document.getElementById('scanBtn');
const clearBtn = document.getElementById('clearBtn');
const msg = document.getElementById('msg');
const resultBox = document.getElementById('result');
const wolfRoar=document.getElementById('wolfRoar'), safeChime=document.getElementById('safeChime');

scanBtn.addEventListener('click', async ()=>{
  const text = msg.value.trim();
  if(!text){ alert('Type a message first'); return; }

  resultBox.textContent='SCANNING — AI CORE';
  resultBox.className='';
  wavePulse();

  try{
    const res = await fetch('https://gokboru-spam-detector-production.up.railway.app/predict', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ text })
    });

    const data = await res.json();

    resultBox.className = data.prediction==='spam' ? 'result-spam' : 'result-ham';
    const msgText = data.prediction==='spam' ? '⚠ SPAM — THREAT LEVEL: RED' : '✔ SAFE — NO MALICIOUS CONTENT';
    let i=0; resultBox.textContent=''; const t = setInterval(()=>{ resultBox.textContent += msgText.charAt(i++); if(i>=msgText.length) clearInterval(t) }, 28);

    if(data.prediction==='spam'){
      try{ wolfRoar.currentTime=0; wolfRoar.play(); }catch(e){}
      makeSparks(18);
    } else {
      try{ safeChime.currentTime=0; safeChime.play(); }catch(e){}
      makeSparks(8);
    }

  }catch(err){
    console.error(err);
    resultBox.textContent='ERROR: Could not reach API — backend offline';
  }
});

clearBtn.addEventListener('click', ()=>{
  msg.value='';
  resultBox.textContent='';
  resultBox.className='';
});
</script>
